<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital AWD System - Interactive Report V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Earthy Green & Beige -->
    <!-- Application Structure Plan: The SPA is structured into four thematic sections (Dashboard, System Deep Dive, Impact, and Resources) accessible via a fixed top navigation. This non-linear design allows different users (e.g., farmers, engineers, stakeholders) to directly access the information most relevant to them. The Dashboard serves as an engaging entry point, providing a simulated real-time overview. The 'System Deep Dive' uses tabs to organize complex technical details without overwhelming the user. 'Impact' focuses on the "why" with clear, visual data comparisons. This structure was chosen to prioritize user-driven exploration and comprehension over the linear format of the original report. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Real-time system status (water level, connectivity). Goal: Inform. Viz: A dynamic gauge (HTML/CSS) and status cards. Interaction: A simulation button updates values to demonstrate system behavior. Justification: More engaging than static numbers. Method: Vanilla JS.
        - Report Info: Water usage comparison. Goal: Compare. Viz: Bar chart. Interaction: Tooltips on hover. Justification: Clearly visualizes the primary benefit (water savings). Library: Chart.js.
        - Report Info: System architecture. Goal: Organize. Viz: Responsive diagram. Interaction: None needed, clarity is key. Justification: Recreates the report's flow diagram accessibly. Method: HTML/Tailwind.
        - Report Info: Technical components (Hardware/Software). Goal: Organize. Viz: Tabbed content view. Interaction: Clicking tabs reveals relevant information. Justification: Prevents information overload on a single page. Method: Vanilla JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8; /* Warm Neutral Background */
            color: #4A4A4A;
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #4A7C59; /* Earthy Green */
            border-bottom-color: #4A7C59;
        }
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .gauge-container {
            width: 250px;
            height: 125px;
            position: relative;
            overflow: hidden;
        }
        .gauge-body {
            width: 100%;
            height: 100%;
            background: #E0E0E0;
            border-radius: 250px 250px 0 0;
            position: absolute;
            top: 0;
            left: 0;
        }
        .gauge-fill {
            width: 100%;
            height: 100%;
            background: #6AAE80; /* Lighter Green */
            border-radius: 250px 250px 0 0;
            position: absolute;
            top: 100%;
            left: 0;
            transform-origin: center bottom;
            transition: transform 0.5s ease-out;
        }
        .gauge-cover {
            width: 80%;
            height: 80%;
            background: #FDFBF8;
            border-radius: 50%;
            position: absolute;
            top: 25%;
            left: 10%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .tab-button.active {
            background-color: #4A7C59;
            color: white;
            border-color: #4A7C59;
        }
        .diagram-box {
            border: 2px solid #D1D5DB;
            background-color: #FFFFFF;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .diagram-arrow {
            position: relative;
            color: #6B7280;
        }
        /* Custom modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Custom Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-text" class="text-gray-800 font-medium"></p>
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <h1 id="main-title" class="text-xl font-bold text-gray-800">Digital AWD System V2</h1>
                <div class="hidden md:flex items-center space-x-8">
                    <button id="v1-button" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full text-sm font-semibold hover:bg-gray-300 transition-colors">Version 1</button>
                    <button id="v2-button" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full text-sm font-semibold hover:bg-gray-300 transition-colors hidden">Version 2</button>
                    <a href="#dashboard" class="nav-link active">Dashboard</a>
                    <a href="#system" class="nav-link">System Deep Dive</a>
                    <a href="#impact" class="nav-link">Impact</a>
                    <a href="#resources" class="nav-link">Resources</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        
        <section id="dashboard" class="mb-20 text-center">
            <h2 class="text-3xl font-bold mb-2">Project Dashboard</h2>
            <p class="max-w-3xl mx-auto text-gray-600 mb-12">
                This dashboard is live and connected to your Google Sheet. It provides a real-time overview of the Digital AWD system's key metrics. The system automates paddy water level monitoring to conserve water and improve crop yields, providing actionable alerts to farmers.
            </p>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center mb-12">
                <div class="bg-white p-6 rounded-lg shadow-lg flex flex-col items-center justify-center h-full">
                    <h3 class="text-lg font-semibold mb-4">Current Water Level (cm)</h3>
                    <div class="gauge-container mx-auto">
                        <div class="gauge-body"></div>
                        <div id="gauge-fill" class="gauge-fill" style="transform: rotate(0.5turn) translate(0, -100%);"></div>
                        <div class="gauge-cover">
                            <span id="water-level-text" class="text-3xl font-bold text-gray-800">15.0</span>
                            <span class="text-sm text-gray-500">cm</span>
                        </div>
                    </div>
                    <p id="water-status-text" class="mt-4 text-xl font-bold text-green-600">Status: Good</p>
                    <button id="simulate-button" class="mt-4 px-6 py-2 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors">Run Simulation</button>
                </div>
                
                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-lg h-full">
                    <h3 class="text-lg font-semibold mb-4 text-left">System Status & Metrics</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-left">
                        <div class="p-4 bg-gray-50 rounded-md">
                            <p class="text-sm text-gray-500">Connectivity</p>
                            <p id="connectivity-status" class="text-xl font-semibold text-gray-800">WiFi</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-md">
                            <p class="text-sm text-gray-500">SD Backup Size</p>
                            <p id="backup-size" class="text-xl font-semibold text-gray-800">0.0 KB</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-md">
                            <p class="text-sm text-gray-500">Last Sync</p>
                            <p id="last-sync" class="text-xl font-semibold text-gray-800">Just Now</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold mb-4 text-left">Water Level Trends (Last 12 Hours)</h3>
                <div class="chart-container h-64 md:h-80 max-w-4xl">
                    <canvas id="waterTrendChart"></canvas>
                </div>
            </div>
        </section>

        <section id="system" class="mb-20 scroll-mt-20">
             <h2 class="text-3xl font-bold mb-2 text-center">System Deep Dive</h2>
            <p class="max-w-3xl mx-auto text-gray-600 mb-12 text-center">
                Explore the technical foundation of the Digital AWD system. This section details the hardware components that form the physical device, the software logic that drives its functionality, and the data flow that connects the field to the cloud.
            </p>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-center border-b border-gray-200 mb-6">
                    <button class="tab-button active py-2 px-6 font-semibold border-b-2" data-tab="hardware">Hardware</button>
                    <button class="tab-button py-2 px-6 font-semibold border-b-2" data-tab="software">Software</button>
                    <button class="tab-button py-2 px-6 font-semibold border-b-2" data-tab="flow">Data Flow</button>
                </div>

                <div id="hardware" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Controller:</strong> ESP32 (38-pin)</div>
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Sensing:</strong> AJ-SR04M Ultrasonic Sensor</div>
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Connectivity:</strong> WiFi & Quectel EC220U-CN (GSM)</div>
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Data Backup:</strong> 32 GB SD Card</div>
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Timekeeping:</strong> RTC DS3231 Module</div>
                        <div class="p-4 border rounded-lg bg-gray-50"><strong>Power:</strong> Solar Panels & 3x Li-ion Batteries</div>
                    </div>
                </div>

                <div id="software" class="tab-content hidden">
                    <p class="mb-4">The system runs on custom firmware for the ESP32 and a Google Apps Script for cloud integration.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2">ESP32 Firmware</h4>
                            <pre class="bg-gray-900 text-white p-4 rounded-lg text-xs overflow-x-auto"><code>// Key Functionality
void loop() {
  // 1. Check network connectivity
  // 2. Read sensor data (median of 5)
  // 3. Get timestamp from RTC
  // 4. Prepare JSON payload
  // 5. Try to send via WiFi/GSM
  // 6. If send fails, save to SD card
  delay(120000); // Wait 2 minutes
}</code></pre>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Google Apps Script</h4>
                            <pre class="bg-gray-900 text-white p-4 rounded-lg text-xs overflow-x-auto"><code>// Key Functionality
function doPost(e) {
  // 1. Parse incoming JSON data
  // 2. Get active spreadsheet
  // 3. Append data as a new row
  // 4. Apply color coding based on status
  // 5. Return success/error response
}</code></pre>
                        </div>
                    </div>
                </div>

                <div id="flow" class="tab-content hidden p-4">
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-4 items-center font-mono text-sm">
                        <div class="diagram-box">Ultrasonic Sensor (AJ-SR04M)</div>
                        <div class="text-center diagram-arrow">→</div>
                        <div class="diagram-box row-start-2 md:row-start-1 md:col-start-3">ESP32 (Controller)</div>
                        
                        <div class="col-span-1 md:col-span-3 text-center diagram-arrow">↓</div>
                        
                        <div class="diagram-box md:col-start-3">RTC DS3231</div>
                         <div class="text-center diagram-arrow md:col-start-2">↑</div>
                        <div class="diagram-box md:col-start-1">SD Card (32GB Backup)</div>
                        
                        <div class="col-span-1 md:col-span-3 text-center diagram-arrow">↓</div>
                        
                        <div class="diagram-box md:col-start-3">WiFi / GSM Module</div>
                        
                        <div class="col-span-1 md:col-span-3 text-center diagram-arrow">↓</div>

                        <div class="diagram-box md:col-start-2">Google Sheets (Cloud)</div>
                        
                        <div class="col-span-1 md:col-span-3 text-center diagram-arrow">↓</div>
                        
                        <div class="diagram-box md:col-start-2">Farmer Alerts (App)</div>

                     </div>
                </div>
            </div>
        </section>

        <section id="impact" class="mb-20 scroll-mt-20">
             <h2 class="text-3xl font-bold mb-2 text-center">Project Impact</h2>
            <p class="max-w-3xl mx-auto text-gray-600 mb-12 text-center">
                The Digital AWD system offers significant benefits for sustainable agriculture. By providing precise, data-driven irrigation insights, it helps conserve water, protect crop yields, and make farming more efficient and resilient.
            </p>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold mb-4">Key Benefits</h3>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1">✔</span>
                            <div><strong>Water Savings:</strong> Reduces irrigation water usage by an estimated 25-30% compared to traditional methods.</div>
                        </li>
                          <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1">✔</span>
                            <div><strong>Yield Protection:</strong> Maintains optimal water levels, preventing crop stress from over- or under-watering.</div>
                        </li>
                          <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1">✔</span>
                            <div><strong>Data-Driven Decisions:</strong> Empower farmers with real-time alerts for timely and efficient irrigation.</div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1">✔</span>
                            <div><strong>Sustainability:</strong> Operates on solar power, promoting an eco-friendly and low-maintenance solution.</div>
                        </li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold mb-4">Water Usage Comparison</h3>
                    <p class="text-sm text-gray-500 mb-4">Estimated water consumption for a single paddy field cycle.</p>
                    <div class="chart-container h-80 max-w-lg">
                        <canvas id="impactChart"></canvas>
                    </div>
                </div>
             </div>
        </section>

        <section id="resources" class="scroll-mt-20">
             <h2 class="text-3xl font-bold mb-2 text-center">Resources & References</h2>
             <p class="max-w-3xl mx-auto text-gray-600 mb-12 text-center">
                 The development of this system was informed by established agricultural science and technology documentation. The following resources provide further information on the core concepts and components used in this project.
            </p>
             <div class="bg-white p-6 rounded-lg shadow-lg">
                <ul class="list-disc list-inside space-y-2">
                    <li>International Rice Research Institute (IRRI) – AWD methodology.</li>
                    <li>Quectel EC220U-CN GSM Datasheet.</li>
                    <li>Espressif ESP32 Developer Documentation.</li>
                    <li>NewPing Arduino Library for Ultrasonic sensor control.</li>
                    <li>ArduinoJson & Google Apps Script Developer Guides.</li>
                </ul>
             </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2025 Digital AWD Monitoring System. A project in collaboration with Dr. Reddy’s Foundation.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const PIPE_HEIGHT_CM = 55.0;
    
    // Version 2 Apps Script URL
    const V2_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyWm9xovHIdtKInQeWJki6KFEnWUKH9EGSzrQtE6Fd8kVeWhQalR9phkxMVU_D204V4/exec';
    
    // Version 1 Apps Script URL - Please provide your URL here.
    const V1_APPS_SCRIPT_URL = 'YOUR_VERSION_1_APPS_SCRIPT_URL_HERE';
    
    let currentVersion = 'V2';
    let fetchInterval;

    const mainTitle = document.getElementById('main-title');
    const v1Button = document.getElementById('v1-button');
    const v2Button = document.getElementById('v2-button');
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('main section');
    const simulateButton = document.getElementById('simulate-button');
    const modal = document.getElementById('modal');
    const modalText = document.getElementById('modal-text');
    const closeButton = document.querySelector('.close-button');

    const waterTrendCtx = document.getElementById('waterTrendChart').getContext('2d');
    const impactCtx = document.getElementById('impactChart').getContext('2d');

    let trendChart;
    let trendLabels = Array.from({ length: 12 }, (_, i) => `${12 - i}h ago`).reverse();
    let trendData = Array.from({ length: 12 }, () => null);
    
    function initializeTrendChart() {
        if (trendChart) {
            trendChart.destroy();
        }
        trendChart = new Chart(waterTrendCtx, {
            type: 'line',
            data: {
                labels: trendLabels,
                datasets: [{
                    label: 'Water Level (cm)',
                    data: trendData,
                    borderColor: '#4A7C59',
                    backgroundColor: 'rgba(74, 124, 89, 0.1)',
                    fill: true,
                    tension: 0.4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: PIPE_HEIGHT_CM,
                        title: {
                            display: true,
                            text: 'Water Level (cm)'
                        }
                    },
                    x: {
                          title: {
                            display: true,
                            text: 'Time'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    function initializeImpactChart() {
        new Chart(impactCtx, {
            type: 'bar',
            data: {
                labels: ['Traditional Flooding', 'Digital AWD System'],
                datasets: [{
                    label: 'Water Usage (Liters, est.)',
                    data: [1000, 720],
                    backgroundColor: ['#A0A0A0', '#4A7C59'],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                 scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Water Usage (Liters, est.)'
                        }
                    }
                }
            }
        });
    }

    function updateGauge(waterLevel) {
        const levelText = document.getElementById('water-level-text');
        const statusText = document.getElementById('water-status-text');
        const gaugeFill = document.getElementById('gauge-fill');
        
        const percentage = Math.min(waterLevel / 25, 1);
        const rotation = percentage * 0.5;
        
        gaugeFill.style.transform = `rotate(${rotation}turn) translate(0, -100%)`;
        levelText.textContent = waterLevel !== null ? waterLevel.toFixed(1) : '...';

        let status, color;
        if (waterLevel < 7) {
            status = 'Low';
            color = 'text-red-600';
        } else if (waterLevel < 15) {
            status = 'Good';
            color = 'text-green-600';
        } else if (waterLevel <= 20) {
            status = 'Excess';
            color = 'text-yellow-600';
        } else {
            status = 'Flooding';
            color = 'text-purple-600';
        }
        statusText.textContent = `Status: ${status}`;
        statusText.className = `mt-4 text-xl font-bold ${color}`;
    }

    function showModal(message) {
        modalText.textContent = message;
        modal.style.display = 'block';
    }

    function hideModal() {
        modal.style.display = 'none';
    }

    async function fetchData() {
        try {
            const url = currentVersion === 'V2' ? V2_APPS_SCRIPT_URL : V1_APPS_SCRIPT_URL;

            // Handle V1 static data display
            if (currentVersion === 'V1') {
                updateDashboardWithStaticData();
                return;
            }

            const response = await fetch(url);
            const data = await response.json();
            
            updateGauge(parseFloat(data['waterLevel']));
            
            document.getElementById('connectivity-status').textContent = data['network'];
            document.getElementById('backup-size').textContent = data['sdSize'] + ' KB';
            document.getElementById('last-sync').textContent = data['syncDate'];
            
            trendData.shift();
            trendData.push(parseFloat(data['waterLevel']));
            trendLabels.shift();
            trendLabels.push(new Date(data['timestamp']).toLocaleTimeString());
            trendChart.update();

        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('connectivity-status').textContent = 'Error';
            document.getElementById('last-sync').textContent = 'Sync Failed';
        }
    }
    
    // Function to update the dashboard with static V1 data
    function updateDashboardWithStaticData() {
        updateGauge(12.5);
        document.getElementById('connectivity-status').textContent = 'Offline (Static)';
        document.getElementById('backup-size').textContent = '1.2 KB';
        document.getElementById('last-sync').textContent = 'N/A';
        trendData = [10.2, 11.5, 12.0, 12.5, 13.0, 12.8, 11.9, 12.3, 12.5, 12.7, 12.1, 12.5];
        trendLabels = Array.from({ length: 12 }, (_, i) => `${12 - i}h ago`).reverse();
        trendChart.data.labels = trendLabels;
        trendChart.data.datasets[0].data = trendData;
        trendChart.update();
    }

    // Function to simulate data updates
    function simulateData() {
        const simulatedWaterLevel = (Math.random() * 20) + 1; // Random level between 1 and 21
        const now = new Date();
        
        updateGauge(simulatedWaterLevel);
        
        // Update trend data for simulation
        trendData.shift();
        trendData.push(simulatedWaterLevel);
        trendLabels.shift();
        trendLabels.push(now.toLocaleTimeString());
        trendChart.update();
        
        // Update other metrics for simulation
        document.getElementById('connectivity-status').textContent = 'WiFi';
        document.getElementById('backup-size').textContent = (Math.random() * 10).toFixed(1) + ' KB';
        document.getElementById('last-sync').textContent = now.toLocaleTimeString();

        showModal('Simulation running with new data!');
        setTimeout(hideModal, 2000); // Hide after 2 seconds
    }
    
    // Function to handle version change
    function toggleVersion(version) {
        if (currentVersion === version) return;
        currentVersion = version;
        
        // Clear existing interval
        if (fetchInterval) {
            clearInterval(fetchInterval);
        }

        if (currentVersion === 'V1') {
            mainTitle.textContent = 'Digital AWD System V1';
            v1Button.classList.add('hidden');
            v2Button.classList.remove('hidden');
            updateDashboardWithStaticData();
        } else {
            mainTitle.textContent = 'Digital AWD System V2';
            v1Button.classList.remove('hidden');
            v2Button.classList.add('hidden');
            fetchData();
            fetchInterval = setInterval(fetchData, 30000);
        }
        
        showModal(`Switched to Version ${currentVersion} Dashboard.`);
        setTimeout(hideModal, 2000); // Hide after 2 seconds
    }


    const tabs = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            tabContents.forEach(content => {
                if (content.id === tab.dataset.tab) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        });
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${id}`);
                });
            }
        });
    }, { rootMargin: "-50% 0px -50% 0px" });

    sections.forEach(section => {
        observer.observe(section);
    });

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });

    v1Button.addEventListener('click', () => toggleVersion('V1'));
    v2Button.addEventListener('click', () => toggleVersion('V2'));

    closeButton.addEventListener('click', hideModal);

    // Hide modal when clicking outside
    window.addEventListener('click', (e) => {
        if (e.target == modal) {
            hideModal();
        }
    });

    simulateButton.addEventListener('click', simulateData);

    initializeTrendChart();
    initializeImpactChart();
    
    // Initial setup for V2 dashboard
    toggleVersion('V2');
});
</script

